<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" href="css/korea.css" />
</head>
<script src="http://code.jquery.com/jquery-latest.js"></script>
<script type="text/javascript" src="js/d3.js"></script>
<script type="text/javascript" src="js/korea.js"></script>
<body>
 <div class="craw">
  	 <h1>검색어로 찾기</h1>
     <input type="text" id="craw_id" name="craw_id" class="form-control" placeholder="ID 입력" style="width:300px;"/>
     <input type="button" id="craw_submit" name="craw_submit" class="btn btn-warning" value="조회"/>  
 </div>
 
 <div class="content_craw">
 </div>
 <div><hr></div>
<div>

  	 <h1>지도로 찾기</h1>
<div id="container"><div id="donm">
</div>
</div>


<div id="totalcount"></div>
</div>
<div class="search">
 	<select onchange="categoryChange(this)" name="donm" id="doselect">
	    <option value=""> 선택하세요 </option>
	    <option th:each="datalist : ${data}" th:text='${datalist.donm}' th:value='${datalist.donm}'></option>
	</select>
	<select onchange="subcategoryChange(this)" name="sigungunm" id="sigunguselect">
	    <option value=""> 선택하세요 </option>
	</select>
</div>
<div class="pagination">
  <a id="prebtn" onclick="prebtn()">&laquo;</a>
  <a id="npage" >1</a>
  <a>/</a>
  <a id="totalcountsix"></a>
  <a id="nextbtn"onclick="nextbtn()">&raquo;</a>
 </div>

<div id="campsite"></div>
<input type="hidden" id="npagex" name="npagex">

 <script type="text/javascript">
 	var page = 1;
 	if(page == 1){
 		$("#prebtn").removeAttr("onclick");
 	}	
 	$("#craw_submit").click(function(){
         $.ajax({
             url :"search/keyword",
             type : "get",
             data :{
            	 keyword : $("#craw_id").val(),
             },
         	 contentType: "application/x-www-form-urlencoded; charset=UTF-8;",
             success:function(data){
            	$(".content_craw").empty();
                for(var i =0; i< data.length; i++){
             		$(".content_craw").append("<tr><th>"+data[i].facltnm +"</th></tr>");    
                }
             }
         })
     })
     
     function categoryChange(e) {
    	page = 1; 
 		var target = document.getElementById("sigunguselect");
    	 $("#npage").empty();
   	 	 $("#npage").append(page);
   	 	 console.log(page)
    	 $.ajax({
             url :"search/sigungucategory",
             type : "get",
             async:false,
             data :{
            	 category : e.value,
             },
         	 contentType: "application/x-www-form-urlencoded; charset=UTF-8;",
             success:function(data){
            	 $("#campsite").empty();
             	 $("#sigunguselect").empty();
             	 $("#totalcountsix").empty();
             	 $("#totalcount").empty();
             	 if(page == 1){
             		$("#prebtn").removeAttr("onclick");
             	 }
             	 var optAll = document.createElement("option");
    			 optAll.value = "";
    			 optAll.innerHTML = "전체";
             	 target.appendChild(optAll);
            	 for(var i =0; i< data.length; i++){
            		var opt = document.createElement("option");
        			opt.value = data[i].sigungunm;
        			opt.innerHTML = data[i].sigungunm;
        			target.appendChild(opt);
        		 }
            	 $.ajax({
                     url :"search/do",
                     type : "get",
                     data :{
                    	 category : e.value
                     },
                     async:false,
                 	 contentType: "application/x-www-form-urlencoded; charset=UTF-8;",
                     success:function(data){
                    	 $('#sigunguselect').css("display","inline");
                    	 $("#totalcount").append(data.count[0].count)
                    	 if(data.length % 6 == 0){
                    		 $("#totalcountsix").append(parseInt((data.count[0].count)/6))
			                    if(page < parseInt((data.count[0].count)/6)) {
				         		$("#nextbtn").attr("onclick","nextbtn()");
				         		}
			                    else if(page == parseInt((data.count[0].count)/6)) {
			    	         		$("#nextbtn").removeAttr("onclick");
			    	         	}
                    	 } else {
                      		$("#totalcountsix").append(parseInt((data.count[0].count)/6)+1)
								if(page < parseInt((data.count[0].count)/6)+1) {
				         			$("#nextbtn").attr("onclick","nextbtn()");
				         		}
								else if(page == parseInt((data.count[0].count)/6)+1) {
            	         		$("#nextbtn").removeAttr("onclick");
            	         	}
                    	 }
			             for(var i =0; i< data.camplist.length; i++){
                    		$("#campsite").append(data.camplist[i].facltnm);    
                    	 }
                     }
                 })
             }
         })
     }
     
     function subcategoryChange(e) {
    	 page = 1;
    	 if(page == 1){
      		$("#prebtn").removeAttr("onclick");
      	}
    	 var dotarget = document.getElementById("doselect");
    	 var sigungutarget = document.getElementById("sigunguselect");
    	 $("#npage").empty();
    	 $("#npage").append(page);
    	 var nowpage = $("#npage").text();
    	 $.ajax({
             url :"search/sigungucamp",
             type : "get",
             data :{
            	 donm : dotarget.value,
            	 category : sigungutarget.value,
            	 npage: parseInt(nowpage)-1
             },
         	 contentType: "application/x-www-form-urlencoded; charset=UTF-8;",
             success:function(data){
            	 $("#campsite").empty();
             	 $("#totalcountsix").empty();
             	 $("#totalcount").empty();
             	 $("#totalcount").append(data.count[0].count)
             	 if(data.count[0].count % 6 == 0){
             	 	$("#totalcountsix").append(parseInt((data.count[0].count)/6))
             	 	if(page < parseInt((data.count[0].count)/6)) {
	         	 		$("#nextbtn").attr("onclick","nextbtn()");
             	 	}
             	 	else if(page == parseInt((data.count[0].count)/6)) {
    	         		$("#nextbtn").removeAttr("onclick");
    	         	}
             	 } else {
             		$("#totalcountsix").append(parseInt((data.count[0].count)/6)+1)
             		if(page < parseInt((data.count[0].count)/6+1)) {
	         			$("#nextbtn").attr("onclick","nextbtn()");
             		}
             		else if(page == parseInt((data.count[0].count)/6)+1) {
    	         		$("#nextbtn").removeAttr("onclick");
    	         	}
             	}
             	 for(var i =0; i< data.camplist.length; i++){
            		$("#campsite").append(data.camplist[i].facltnm);    
            	 }
             }
         })
     }     
     function nextbtn() {
    	var dotarget = document.getElementById("doselect");
    	var sigungutarget = document.getElementById("sigunguselect");
    	$("#npage").empty();
    	$("#npage").append(page+1)
    	page++;
    	if(page > 1){
    		$("#prebtn").attr("onclick","prebtn()");
    	}
    	
    	$.ajax({
         url :"search/sigungucamp",
         type : "get",
         data :{
        	 donm : dotarget.value,
        	 category : sigungutarget.value,
        	 npage: page-1
         },
     	 contentType: "application/x-www-form-urlencoded; charset=UTF-8;",
         success:function(data){
        	 $("#campsite").empty();
         	 $("#totalcountsix").empty();
         	 $("#totalcount").empty();
         	 $("#totalcount").append(data.count[0].count)
         	
         	 if(data.count[0].count % 6 == 0){
         	 	endpage = $("#totalcountsix").append(parseInt((data.count[0].count)/6))
	         	if(page == parseInt((data.count[0].count)/6)) {
	         		$("#nextbtn").removeAttr("onclick");
	         	}
         	  } 
         	  else {
         		endpage = $("#totalcountsix").append(parseInt((data.count[0].count)/6)+1)
             	if(page == parseInt((data.count[0].count)/6)+1) {
	         		$("#nextbtn").removeAttr("onclick");
	         	}
         	 }
         	 for(var i =0; i< data.camplist.length; i++){
         		if(data.camplist[i].firstimageurl != "no data") {
        			$("#campsite").append("<img src="+data.camplist[i].firstimageurl+" width:300px height:300px>");    
         		}
         		else {
         			$("#campsite").append("이미지가 없습니다.")
         		}
         	}
           }
     	})
     	
     }
     
     function prebtn() {
     	var dotarget = document.getElementById("doselect");
     	var sigungutarget = document.getElementById("sigunguselect");
	  	$('#npage').empty();
     	$('#npage').append(page-1);
     	page--;
    	if(page == 1){
     		$("#prebtn").removeAttr("onclick");
     	}
    	$.ajax({
          url :"search/sigungucamp",
          type : "get",
          data :{
         	 donm : dotarget.value,
         	 category : sigungutarget.value,
         	 npage: page-1
          },
      	 contentType: "application/x-www-form-urlencoded; charset=UTF-8;",
          success:function(data){
         	 $("#campsite").empty();
          	 $("#totalcountsix").empty();
          	 $("#totalcount").empty();
          	 $("#totalcount").append(data.count[0].count)
          	 if(data.count[0].count % 6 == 0){
          	 	endpage = $("#totalcountsix").append(parseInt((data.count[0].count)/6))
          		if(page < parseInt((data.count[0].count)/6)) {
	         		$("#nextbtn").attr("onclick","nextbtn()");
	         	}
          	 } else {
          		endpage = $("#totalcountsix").append(parseInt((data.count[0].count)/6)+1)
             	if(page < parseInt((data.count[0].count)/6)+1) {
	         		$("#nextbtn").attr("onclick","nextbtn()");
	         	}
          	 }
          	 for(var i =0; i< data.camplist.length; i++){
         		$("#campsite").append(data.camplist[i].facltnm);    
         	 }
          }
      	})
      } 
    
     
     
     
 </script>
</body>
</html>