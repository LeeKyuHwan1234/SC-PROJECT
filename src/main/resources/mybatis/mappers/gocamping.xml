<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.camping.camp.dao.CampDao">
	<select id="getOpenApi" resultType="CampDto">
         SELECT addr1,contentid, facltnm, addr1 FROM gocampingapi ORDER BY contentid DESC LIMIT 15
 	</select>
 	<select id="getPlaceDetail" resultType="CampDto" parameterType="CampDto">
         SELECT * FROM gocampingapi WHERE contentid = #{encurl}
 	</select>
 	<select id="getSearchCamp" resultType="CampDto" parameterType="CampDto">
         SELECT facltnm FROM gocampingapi WHERE facltnm LIKE CONCAT('%', #{encurl}, '%') OR donm LIKE CONCAT('%', #{encurl}, '%')
         OR sigungunm LIKE CONCAT('%', #{encurl}, '%') OR addr1 LIKE CONCAT('%', #{encurl}, '%') OR addr2 LIKE CONCAT('%', #{encurl}, '%')
    </select>
    <select id="getSearchDo" resultType="CampDto" parameterType="HashMap">
         SELECT addr1,contentid,firstimageurl,facltnm FROM gocampingapi 
         <choose> 
      	 	<when test="category != '전국'">
      	 		 WHERE donm = #{category} LIMIT 9 OFFSET CAST(#{npage} AS INTEGER) * 9
      	 	</when>
      	 	<when test="category == '전국'">
      	 		LIMIT 9 OFFSET CAST(#{npage} AS INTEGER) * 9
      	 	</when>
      	 </choose>
    </select>
    <select id="getSearchDoCount" resultType="CampDto" parameterType="HashMap">
       	SELECT COUNT(facltnm) as count FROM gocampingapi
       	<choose> 
      	 	<when test="category != '전국'">
      	 		  WHERE donm = #{category}
      	 	</when>
      	</choose>
    </select>
    <select id="getSearchSigungu" resultType="CampDto" parameterType="CampDto">
         SELECT addr1,contentid,firstimageurl,facltnm FROM gocampingapi WHERE sigungunm = #{category}
    </select>
    <select id="getSearchSigunguCount" resultType="CampDto" parameterType="HashMap">
       	SELECT COUNT(facltnm) as count FROM gocampingapi  
       	 <choose>
      	 	<when test='donm == "전국"'>
      	 	</when>
      	 	<when test='donm != "전국" and category == ""'>
      	 		WHERE donm = #{donm}
      	 	</when>
      	  	<when test='category != ""'>
      	  		WHERE donm = #{donm} and sigungunm=#{category}
      	  	</when>
    	</choose>
    </select>
   	<select id="getDoCategory" resultType="CampDto" parameterType="CampDto">
         SELECT DISTINCT donm FROM gocampingapi
    </select>
    <select id="getSigunguCategory" resultType="CampDto" parameterType="CampDto">
      	 SELECT DISTINCT sigungunm FROM gocampingapi WHERE donm = #{encurl}
    </select>
    <select id="getSigunguCamp" resultType="CampDto" parameterType="HashMap">
      	 SELECT addr1,contentid,firstimageurl,facltnm FROM gocampingapi
      	 <choose> 
      	 	<when test="donm == '전국' and category == ''">
      	 		LIMIT 9 OFFSET CAST(#{npage} AS INTEGER) * 9
      	 	</when>
      	 	<when test='donm != "" and category == ""'>
      	 		 WHERE donm = #{donm} LIMIT 9 OFFSET CAST(#{npage} AS INTEGER) * 9
      	 	</when>
	      	<when test='category != ""'>
	      	   WHERE donm = #{donm} and sigungunm = #{category} LIMIT 9 OFFSET CAST(#{npage} AS INTEGER) * 9
	    	</when>
      	 </choose>
     </select> 
     <select id="getTotalCamp" resultType="CampDto">
     	SELECT addr1,contentid,firstimageurl,facltnm FROM gocampingapi LIMIT 9 OFFSET 0
     </select>
     <select id="getTotalCampCount" resultType="CampDto">
     	SELECT COUNT(facltnm) as count FROM gocampingapi
     </select>
 </mapper>


